<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Raum Steuerung</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Raum Steuerung</h1>
    
    <div class="all-rooms-control">
        <button class="btn-on" onclick="toggleAllRooms('on')">Alle AN</button>
        <button class="btn-off" onclick="toggleAllRooms('off')">Alle AUS</button>
    </div>

    <table>
        <tr>
            <th>Raum</th>
            <th>Status</th>
        </tr>
        {% for group_key, group_info in groups.items() %}
        {% if group_key != 'all' %}
        <tr>
            <td>{{ group_info.name }}</td>
            <td>
                <label class="switch">
                    <input type="checkbox" 
                           data-group="{{ group_key }}" 
                           {% if group_status[group_key] %}checked{% endif %}>
                    <span class="slider"></span>
                </label>
            </td>
        </tr>
        {% endif %}
        {% endfor %}
    </table>

    <div class="plugs-container">
        <h2>Steuerbare Steckdosen</h2>
        {% for plug_key, plug_info in plugs.items() %}
        <div class="plug-row">
            <span class="plug-label">{{ plug_info.name }}</span>
            <label class="switch">
                <input type="checkbox" 
                       data-group="{{ plug_key }}" 
                       {% if plug_status[plug_key] %}checked{% endif %}>
                <span class="slider"></span>
            </label>
        </div>
        {% endfor %}
    </div>
    <script>
function toggleAllRooms(state) {
    fetch(`/toggle/all_${state}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        })
        .catch(error => {
            console.error('Fehler:', error);
        });
}

// Einzelner Listener fÃ¼r alle Slider
document.querySelectorAll('.switch input[data-group]').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        const group = this.getAttribute('data-group');
        fetch(`/toggle/${group}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            })
            .catch(error => {
                console.error('Fehler:', error);
            });
    });
});
</script>
</body>
</html>
